%
% Daily QA w/ Siemens phantom w/ 64ch head-neck coil
% @chm - 08/13/2204
%

% Release memory
clear all;

% Study folder information
pfolder = '/Volumes/Leopard-WS-barracuda2/OngoingResearch2/QADaily';

% Four scans done at Prisma 1, 2, 3 w/ different coil&phantom setting
scanner = {...
    'Prisma1',...
    'Prisma2',...
    'Prisma2',...
    'Prisma3',...
    'Prisma3',...
    };
study  = {...
    'QA_PRISMA1QA_20240809_173010_559000',...
    'QA_PRISMA2QA_20240809_174910_732000',...
    'QA_PRISMA2QA_20240809_180905_626000',...
    'QA_PRISMA3QA_20240809_180204_160000',...
    'QA_PRISMA3QA_20240809_182158_666000',...
    };
series  = {...
    'EP2D_BOLD_P2_S2_5MIN_0003',...
    'EP2D_BOLD_P2_S2_5MIN_0003',...
    'EP2D_BOLD_P2_S2_5MIN_0003',...
    'EP2D_BOLD_P2_S2_5MIN_0003',...
    'EP2D_BOLD_P2_S2_5MIN_0003',...
    };
tlabel = {...
    'Coil1Phant1@P1',...
    'Coil1Phant1@P2',...
    'Coil2Phant2@P2',...
    'Coil3Phant3@P3',...
    'Coil3Phant3@P3',...
    };

n = length(tlabel);

% call funtion
reportstatgrp = [];
bfig = 0;
for i=1:n
    tpfolder = [pfolder '/' scanner{1,i} '/' study{1,i} '/' series{1,i}];
    [stat] = dostat(tpfolder,tlabel,bfig);
    
    stat.tlabel = tlabel{1,i};
    stat.dicominfo.StudyDescription;
    stat.dicominfo.StudyDate;
    stat.dicominfo.StationName;
    stat.dicominfo.SequenceName;
    stat.dicominfo.ProtocolName;
    stat.dicominfo.CoilString;
    stat.dicominfo.ImageTypeText;
    
    %disp(stat);

    reportstat = [stat.snrpk stat.aliaspk stat.bkoffpk stat.tsnrpk stat.shim(1:end-1) stat.shim(end)/1000];
    %disp(reportstat);

    reportstatgrp = [reportstatgrp; reportstat];
end

txlabel = {'SNR','ALIAS','BGOff','tSNR'};
figure(1); subplot(3,1,1); bar(txlabel,reportstatgrp(:,1:4)); legend(tlabel);
txlabel = {'X','Y','Z','X2','Y2','Z2','XY','S2'};
figure(1); subplot(3,1,2); bar(txlabel,reportstatgrp(:,5:end-1)); legend(tlabel);
figure(1); subplot(3,1,3); bar(reportstatgrp(:,end:end)); legend('B0');